(this["webpackJsonptidb-dashboard-ui"]=this["webpackJsonptidb-dashboard-ui"]||[]).push([[6],{1663:function(e,t,n){},1671:function(e,t,n){"use strict";n.r(t);var a=n(135),r=n(0),i=n.n(r),c=n(136),o=n(22),l=n(1501),s=n(1495),u=n(192),m=n(510),d=n(219),f=(n(110),n(44)),p=(n(540),n(359)),b=n(296),h=n(1507),v=n(138),y=n(49),g=n(111),E=p.a.Text;function _(e){return e.filter((function(e,t,n){return n.findIndex((function(t){return t.partition.path===e.partition.path}))===t}))}function O(){var e=Object(m.a)().t,t=Object(g.b)((function(e){return y.b.getInstance().getHostsInfo({cancelToken:e})})),n=t.data,r=t.isLoading,c=[{name:e("cluster_info.list.host_table.columns.ip"),key:"ip",minWidth:100,maxWidth:150,onRender:function(t){var n=t.ip;return t.unavailable?i.a.createElement(f.a,{title:e("cluster_info.list.host_table.instanceUnavailable")},i.a.createElement(E,{type:"warning"},i.a.createElement(h.a,null)," ",n)):n}},{name:e("cluster_info.list.host_table.columns.cpu"),key:"cpu_core",minWidth:60,maxWidth:100,onRender:function(e){var t=e.cpu_core;return void 0!==t?"".concat(t," vCPU"):""}},{name:e("cluster_info.list.host_table.columns.cpu_usage"),key:"cpu_usage",minWidth:100,maxWidth:150,onRender:function(e){var t=e.cpu_usage;if(void 0!==t){var n=t.system,r=1-n-t.idle,c="\nUser:   ".concat(Object(v.getValueFormat)("percentunit")(r),"\nSystem: ").concat(Object(v.getValueFormat)("percentunit")(n));return i.a.createElement(f.a,{title:i.a.createElement(a.v,null,c.trim())},i.a.createElement(a.c,{value:[r,n],colors:[null,b.red[4]],capacity:1}))}}},{name:e("cluster_info.list.host_table.columns.memory"),key:"memory",minWidth:60,maxWidth:100,onRender:function(e){var t=e.memory;return void 0!==t?Object(v.getValueFormat)("bytes")(t.total,1):""}},{name:e("cluster_info.list.host_table.columns.memory_usage"),key:"memory_usage",minWidth:100,maxWidth:150,onRender:function(e){var t=e.memory;if(void 0!==t){var n=t.total,r=t.used,c=(r/n).toFixed(3),o=i.a.createElement("div",null,"Used: ",Object(v.getValueFormat)("bytes")(r,1)," (",Object(v.getValueFormat)("percentunit")(+c,1),")");return i.a.createElement(f.a,{title:o},i.a.createElement(a.c,{value:r,capacity:n}))}}},{name:e("cluster_info.list.host_table.columns.deploy"),key:"deploy",minWidth:100,maxWidth:200,onRender:function(e){var t=e.partitions;if(void 0!==t&&0!==t.length){var n={tidb:0,tikv:0,pd:0,tiflash:0};return _(t).map((function(e,a){var r=e.partition.path;t.forEach((function(e){e.partition.path===r&&n[e.instance.server_type]++}));var c=[];n.tidb>0&&c.push("".concat(n.tidb," TiDB")),n.tikv>0&&c.push("".concat(n.tikv," TiKV")),n.pd>0&&c.push("".concat(n.pd," PD")),n.tiflash>0&&c.push("".concat(n.tiflash," TiFlash"));var o="".concat(c.join(","),": ").concat(e.partition.fstype.toUpperCase()," ").concat(r);return i.a.createElement(f.a,{title:o,key:a},i.a.createElement("div",null,o))}))}}},{name:e("cluster_info.list.host_table.columns.disk_size"),key:"disk_size",minWidth:80,maxWidth:100,onRender:function(e){var t=e.partitions;if(void 0!==t&&0!==t.length)return _(t).map((function(e,t){return i.a.createElement("div",{key:t},Object(v.getValueFormat)("bytes")(e.partition.total,1))}))}},{name:e("cluster_info.list.host_table.columns.disk_usage"),key:"disk_usage",minWidth:100,maxWidth:150,onRender:function(e){var t=e.partitions;if(void 0!==t&&0!==t.length)return _(t).map((function(e,t){var n=e.partition,r=n.total,c=r-n.free,o=(c/r).toFixed(3),l=i.a.createElement("div",null,"Used: ",Object(v.getValueFormat)("bytes")(c,1)," (",Object(v.getValueFormat)("percentunit")(+o,1),")");return i.a.createElement(f.a,{title:l,key:t},i.a.createElement(a.c,{value:c,capacity:r}))}))}}];return i.a.createElement(a.f,{cardNoMargin:!0,loading:r,columns:c,items:n||[]})}var j=n(32),k=n.n(j),x=n(66),T=n(11),W=(n(36),n(1663),n(4)),w=n.n(W),C=n(64);function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},V=function(e){return r.createElement(C.a,null,(function(t){var n,a=t.getPrefixCls,i=t.direction,c=e.prefixCls,o=e.type,l=void 0===o?"horizontal":o,s=e.orientation,u=void 0===s?"center":s,m=e.className,d=e.children,f=e.dashed,p=e.plain,b=N(e,["prefixCls","type","orientation","className","children","dashed","plain"]),h=a("divider",c),v=u.length>0?"-".concat(u):u,y=!!d,g=w()(m,h,"".concat(h,"-").concat(l),(R(n={},"".concat(h,"-with-text"),y),R(n,"".concat(h,"-with-text").concat(v),y),R(n,"".concat(h,"-dashed"),!!f),R(n,"".concat(h,"-plain"),!!p),R(n,"".concat(h,"-rtl"),"rtl"===i),n));return r.createElement("div",P({className:g},b,{role:"separator"}),d&&r.createElement("span",{className:"".concat(h,"-inner-text")},d))}))},F=(n(549),n(137),n(176)),S=n.n(F),I=n(37),D=n(177),z=n(68),B=n(150),A=n(345);function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done)&&(n.push(c.value),!t||n.length!==t);a=!0);}catch(l){r=!0,i=l}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var K=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},L=r.forwardRef((function(e,t){var n=M(r.useState(e.visible),2),a=n[0],i=n[1];r.useEffect((function(){"visible"in e&&i(e.visible)}),[e.visible]),r.useEffect((function(){"defaultVisible"in e&&i(e.defaultVisible)}),[e.defaultVisible]);var c=function(t,n){"visible"in e||i(t),e.onVisibleChange&&e.onVisibleChange(t,n)},o=function(t){c(!1,t),e.onConfirm&&e.onConfirm.call(void 0,t)},l=function(t){c(!1,t),e.onCancel&&e.onCancel.call(void 0,t)},s=r.useContext(C.b).getPrefixCls,u=e.prefixCls,m=e.placement,d=K(e,["prefixCls","placement"]),p=s("popover",u),b=r.createElement(z.a,{componentName:"Popconfirm",defaultLocale:B.a.Popconfirm},(function(t){return function(t,n){var a=e.okButtonProps,i=e.cancelButtonProps,c=e.title,s=e.cancelText,u=e.okText,m=e.okType,d=e.icon;return r.createElement("div",{className:"".concat(t,"-inner-content")},r.createElement("div",{className:"".concat(t,"-message")},d,r.createElement("div",{className:"".concat(t,"-message-title")},Object(A.a)(c))),r.createElement("div",{className:"".concat(t,"-buttons")},r.createElement(I.a,H({onClick:l,size:"small"},i),s||n.cancelText),r.createElement(I.a,H({onClick:o},Object(D.a)(m),{size:"small"},a),u||n.okText)))}(p,t)}));return r.createElement(f.a,H({},d,{prefixCls:p,placement:m,onVisibleChange:function(t){e.disabled||c(t)},visible:a,overlay:b,ref:t}))}));L.defaultProps={transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary",icon:r.createElement(S.a,null),disabled:!1};var q=L,J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},Z=n(12),$=function(e,t){return r.createElement(Z.a,Object.assign({},e,{ref:t,icon:J}))};$.displayName="DeleteOutlined";var G=r.forwardRef($),Q=n(21),X=n(218),Y=n(78);function ee(e){var t=e.node,n=e.onHideTiDB,r=Object(m.a)().t,c=Object(Q.f)((function(){n&&n(t)}));return i.a.createElement("span",null,"tidb"===t.instanceKind&&t.status!==Y.c.Up&&i.a.createElement(i.a.Fragment,null,i.a.createElement(q,{title:r("cluster_info.list.instance_table.actions.hide_db.confirm"),onConfirm:c},i.a.createElement(f.a,{title:r("cluster_info.list.instance_table.actions.hide_db.tooltip")},i.a.createElement("a",null,i.a.createElement(G,null)))),i.a.createElement(V,{type:"vertical"})),i.a.createElement(a.q,{status:t.status}))}function te(){var e=Object(m.a)().t,t=Object(g.b)((function(e){return y.b.getInstance().getTiDBTopology({cancelToken:e})})),n=t.data,c=t.isLoading,o=t.error,l=t.sendRequest,s=Object(g.b)((function(e){return y.b.getInstance().getStoreTopology({cancelToken:e})})),u=s.data,d=s.isLoading,p=s.error,b=Object(g.b)((function(e){return y.b.getInstance().getPDTopology({cancelToken:e})})),h=b.data,v=b.isLoading,E=b.error,_=Object(r.useMemo)((function(){return Object(Y.d)({dataPD:h,dataTiDB:n,dataTiKV:null===u||void 0===u?void 0:u.tikv,dataTiFlash:null===u||void 0===u?void 0:u.tiflash,includeTiFlash:!0})}),[n,u,h]),O=Object(T.a)(_,2),j=O[0],W=O[1],w=Object(r.useCallback)(function(){var e=Object(x.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.b.getInstance().topologyTidbAddressDelete("".concat(t.ip,":").concat(t.port));case 2:l();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[l]),C=Object(r.useMemo)((function(){return[{name:e("cluster_info.list.instance_table.columns.node"),key:"node",minWidth:100,maxWidth:160,onRender:function(e){var t=e.ip,n=e.port,a="".concat(t,":").concat(n);return i.a.createElement(f.a,{title:a},i.a.createElement("span",null,a))}},{name:e("cluster_info.list.instance_table.columns.status"),key:"status",minWidth:100,maxWidth:120,onRender:function(e){return i.a.createElement(ee,{node:e,onHideTiDB:w})}},{name:e("cluster_info.list.instance_table.columns.up_time"),key:"start_timestamp",minWidth:100,maxWidth:150,onRender:function(e){var t=e.start_timestamp;if(void 0!==t&&0!==t)return i.a.createElement(X.a.Calendar,{unixTimestampMs:1e3*t})}},{name:e("cluster_info.list.instance_table.columns.version"),fieldName:"version",key:"version",minWidth:100,maxWidth:150,onRender:function(e){var t=e.version;return i.a.createElement(f.a,{title:t},i.a.createElement("span",null,t))}},{name:e("cluster_info.list.instance_table.columns.git_hash"),fieldName:"git_hash",key:"git_hash",minWidth:100,maxWidth:200,onRender:function(e){var t=e.git_hash;return i.a.createElement(f.a,{title:t},i.a.createElement("span",null,t))}},{name:e("cluster_info.list.instance_table.columns.deploy_path"),fieldName:"deploy_path",key:"deploy_path",minWidth:150,maxWidth:300,onRender:function(e){var t=e.deploy_path;return i.a.createElement(f.a,{title:t},i.a.createElement("span",null,t))}}]}),[e,w]);return i.a.createElement(a.f,{disableSelectionZone:!0,cardNoMargin:!0,loading:c||d||v,columns:C,items:j,groups:W,errors:[o,p,E]})}function ne(e,t){return i.a.createElement(s.a,{stickyPosition:u.a.Header},i.a.createElement(t,e))}function ae(){var e=Object(o.i)().tabKey,t=Object(o.h)(),n=Object(m.a)().t;return i.a.createElement(l.a,{style:{height:"100vh"}},i.a.createElement(a.e,null,i.a.createElement(d.a,{defaultActiveKey:e,onChange:function(e){t("/cluster_info/".concat(e))},renderTabBar:ne,animated:!1},i.a.createElement(d.a.TabPane,{tab:n("cluster_info.list.instance_table.title"),key:"instance"},i.a.createElement(te,null)),i.a.createElement(d.a.TabPane,{tab:n("cluster_info.list.host_table.title"),key:"host"},i.a.createElement(O,null)))))}t.default=function(){return i.a.createElement(a.w,null,i.a.createElement(c.a,null,i.a.createElement(o.d,null,i.a.createElement(o.b,{path:"/cluster_info",element:i.a.createElement(o.a,{to:"/cluster_info/instance",replace:!0})}),i.a.createElement(o.b,{path:"/cluster_info/:tabKey",element:i.a.createElement(ae,null)}))))}}}]);
//# sourceMappingURL=app_cluster_info.009fa686.chunk.js.map