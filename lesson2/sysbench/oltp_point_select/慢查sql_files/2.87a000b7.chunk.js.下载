(this["webpackJsonptidb-dashboard-ui"]=this["webpackJsonptidb-dashboard-ui"]||[]).push([[2],{1529:function(e,t,a){"use strict";a.d(t,"b",(function(){return v})),a.d(t,"a",(function(){return h}));a(110);var n=a(44),r=a(75),c=a(0),i=a.n(c),l=a(510),o=a(138),u=a(135),m=a(28),s={en:{name:"Name",value:"Value",time:"Time",desc:"Description"},zh:{name:"\u540d\u79f0",value:"\u503c",time:"\u65f6\u95f4",desc:"\u63cf\u8ff0"}};for(var d in s)Object(m.b)(d,{component:{commonColumn:s[d]}});function y(e){var t,a=e.transKey,n=e.noFallback,r=Object(l.a)().t;return n&&(t={defaultValue:"",fallbackLng:"_"}),i.a.createElement("span",null,r(a,t))}function b(e){return i.a.createElement(u.y.TransKey,{transKey:"component.commonColumn.".concat(e)})}function f(e){return{name:b("name"),key:"key",minWidth:150,maxWidth:250,onRender:function(t){return t.keyDisplay?t.keyDisplay:i.a.createElement(y,{transKey:"".concat(e).concat(t.key)})}}}function _(e){var t,a=e&&null!==(t=Object(r.max)(e.map((function(e){return Object(r.max)([e.max,e.min,e.avg,e.value])}))))&&void 0!==t?t:0;return{name:b("time"),key:"time",minWidth:150,maxWidth:200,onRender:function(e){var t,r=[];e.avg&&r.push("Mean: ".concat(Object(o.getValueFormat)("ns")(e.avg,1))),e.min&&r.push("Min:  ".concat(Object(o.getValueFormat)("ns")(e.min,1))),e.max&&r.push("Max:  ".concat(Object(o.getValueFormat)("ns")(e.max,1)));var c=i.a.createElement(u.c,{textWidth:70,value:null!==(t=e.avg)&&void 0!==t?t:e.value,max:e.max,min:e.min,capacity:a},null!=e.avg?Object(o.getValueFormat)("ns")(e.avg,1):Object(o.getValueFormat)("ns")(e.value,1));return r.length>0?i.a.createElement(n.a,{title:i.a.createElement(u.v,null,r.join("\n").trim())},c):c}}}function p(e){return{name:b("desc"),key:"description",minWidth:150,maxWidth:300,onRender:function(t){return i.a.createElement(y,{transKey:"".concat(e).concat(t.key,"_tooltip"),noFallback:!0})}}}function v(e){return[f(e),{name:b("value"),key:"value",fieldName:"value",minWidth:150,maxWidth:250},p(e)]}function h(e,t){return[f(e),_(t),p(e)]}},1530:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return _}));var n=a(32),r=a.n(n),c=a(1),i=a(94),l=a(66),o=a(11),u=a(0),m=a(21),s=a(49),d=a(135),y=a(1559),b={orderBy:"Time",desc:!0},f={timeRange:void 0,schemas:[],searchText:"",limit:100,digest:"",plans:[]};function _(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=Object(y.a)("slow_query",t,b),n=a.orderOptions,_=a.changeOrder,p=Object(u.useState)(e||f),v=Object(o.a)(p,2),h=v[0],k=v[1],O=Object(m.g)("slow_query.query_options",e||f),E=Object(o.a)(O,2),g=E[0],j=E[1],x=Object(u.useMemo)((function(){return t?g:h}),[t,h,g]),w=Object(u.useMemo)((function(){var e=Object(d.D)(x.timeRange),t=Object(o.a)(e,2);return{beginTime:t[0],endTime:t[1]}}),[x]),q=Object(u.useState)([]),W=Object(o.a)(q,2),T=W[0],C=W[1],S=Object(u.useState)(!0),R=Object(o.a)(S,2),K=R[0],M=R[1],N=Object(u.useState)([]),Q=Object(o.a)(N,2),F=Q[0],L=Q[1],V=Object(u.useState)(0),z=Object(o.a)(V,2),D=z[0],I=z[1];function P(e){t?j(e):k(e)}var B=Object(u.useState)([]),A=Object(o.a)(B,2),G=A[0],J=A[1];function U(){J([]),I((function(e){return e+1}))}return Object(u.useEffect)((function(){function e(){return(e=Object(l.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.b.getInstance().infoDatabasesGet();case 3:t=e.sent,C((null===t||void 0===t?void 0:t.data)||[]),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),J((function(t){return[].concat(Object(i.a)(t),[Object(c.a)({},e.t0)])}));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(u.useEffect)((function(){function e(){return(e=Object(l.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(!0),e.prev=1,e.next=4,s.b.getInstance().slowQueryListGet(x.schemas,n.desc,x.digest,x.limit,w.endTime,w.beginTime,n.orderBy,x.plans,x.searchText);case 4:t=e.sent,L(t.data||[]),J([]),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),J((function(t){return[].concat(Object(i.a)(t),[Object(c.a)({},e.t0)])}));case 12:M(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[x,n,w,D]),{queryOptions:x,setQueryOptions:P,orderOptions:n,changeOrder:_,refresh:U,allSchemas:T,loadingSlowQueries:K,slowQueries:F,queryTimeRange:w,errors:G}}},1532:function(e,t,a){"use strict";function n(e,t,a){var n=window.location,r=n.origin,c=n.pathname,i="".concat(r).concat(c,"#").concat(e);t.metaKey||t.altKey||t.ctrlKey?window.open(i,"_blank"):t.shiftKey?window.open(i):a(e)}a.d(t,"a",(function(){return n}))},1533:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(110);var n=a(44),r=(a(295),a(147)),c=(a(293),a(139)),i=a(1),l=a(11),o=(a(294),a(193)),u=(a(1531),a(1535)),m=a(0),s=a.n(m),d=a(510),y=a(1510),b=a(1509),f=a(1501),_=a(21),p=a(135),v=a(1536),h=a(1530),k=u.a.Option,O=o.a.Search,E=[100,200,500,1e3],g={sql:!0,Time:!0,Query_time:!0,Mem_max:!0};t.b=function(){var e=Object(d.a)().t,t=Object(h.b)(),a=t.queryOptions,o=t.setQueryOptions,j=t.orderOptions,x=t.changeOrder,w=t.refresh,q=t.allSchemas,W=t.loadingSlowQueries,T=t.slowQueries,C=t.errors,S=Object(m.useState)([]),R=Object(l.a)(S,2),K=R[0],M=R[1],N=Object(_.d)("slow_query.visible_column_keys",g),Q=Object(l.a)(N,2),F=Q[0],L=Q[1],V=Object(_.d)("slow_query.show_full_sql",!1),z=Object(l.a)(V,2),D=z[0],I=z[1];return s.a.createElement("div",{style:{height:"100vh",display:"flex",flexDirection:"column"}},s.a.createElement(p.e,null,s.a.createElement(p.B,null,s.a.createElement(c.a,null,s.a.createElement(p.A,{value:a.timeRange,onChange:function(e){return o(Object(i.a)(Object(i.a)({},a),{},{timeRange:e}))}}),s.a.createElement(p.t.Plain,{placeholder:e("statement.pages.overview.toolbar.schemas.placeholder"),selectedValueTransKey:"statement.pages.overview.toolbar.schemas.selected",columnTitle:e("statement.pages.overview.toolbar.schemas.columnTitle"),value:a.schemas,style:{width:150},onChange:function(e){return o(Object(i.a)(Object(i.a)({},a),{},{schemas:e}))},items:q}),s.a.createElement(O,{defaultValue:a.searchText,onSearch:function(e){return o(Object(i.a)(Object(i.a)({},a),{},{searchText:e}))}}),s.a.createElement(u.a,{value:a.limit,style:{width:150},onChange:function(e){return o(Object(i.a)(Object(i.a)({},a),{},{limit:e}))}},E.map((function(e){return s.a.createElement(k,{value:e,key:e},"Limit ",e)})))),s.a.createElement(c.a,null,K.length>0&&s.a.createElement(p.h,{columns:K,visibleColumnKeys:F,resetColumnKeys:g,onChange:L,foot:s.a.createElement(r.a,{checked:D,onChange:function(e){return I(e.target.checked)}},e("statement.pages.overview.toolbar.select_columns.show_full_sql"))}),s.a.createElement(n.a,{title:e("statement.pages.overview.toolbar.refresh")},W?s.a.createElement(y.a,null):s.a.createElement(b.a,{onClick:w}))))),s.a.createElement("div",{style:{height:"100%",position:"relative"}},s.a.createElement(f.a,null,s.a.createElement(v.a,{cardNoMarginTop:!0,loading:W,errors:C,slowQueries:T,orderBy:j.orderBy,desc:j.desc,showFullSQL:D,visibleColumnKeys:F,onGetColumns:M,onChangeOrder:x}))))}},1536:function(e,t,a){"use strict";var n=a(17),r=a(21),c=a(0),i=a.n(c),l=a(22),o=a(135),u=a(1532),m=a(1542),s=(a(110),a(44)),d=(a(541),a(148)),y=a(75),b=a(25),f=a(510),_=a(138);function p(e){var t=e.status,a=Object(f.a)().t;return i.a.createElement(d.a,{status:t,text:a("slow_query.common.status.".concat(t))})}function v(e){return i.a.createElement(o.y.TransKey,{transKey:"slow_query.fields.".concat(e)})}function h(e,t){return{name:v("sql"),key:"sql",fieldName:"sql",minWidth:200,maxWidth:500,onRender:function(e){return t?i.a.createElement(o.z,{multiline:!0},i.a.createElement(o.o,{sql:e.query})):i.a.createElement(s.a,{title:i.a.createElement(o.o,{sql:e.query,theme:"dark"}),placement:"right"},i.a.createElement(o.z,null,i.a.createElement(o.o,{sql:e.query,compact:!0})))}}}function k(e){var t,a=e&&null!==(t=Object(y.max)(e.map((function(e){return e.query_time}))))&&void 0!==t?t:0;return{name:v("query_time"),key:"Query_time",fieldName:"query_time",minWidth:140,maxWidth:200,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.c,{textWidth:70,value:e.query_time,capacity:a},Object(_.getValueFormat)("s")(e.query_time,1))}}}function O(e){var t,a=e&&null!==(t=Object(y.max)(e.map((function(e){return e.parse_time}))))&&void 0!==t?t:0;return{name:v("parse_time"),key:"Parse_time",fieldName:"parse_time",minWidth:140,maxWidth:200,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.c,{textWidth:70,value:e.parse_time,capacity:a},Object(_.getValueFormat)("s")(e.parse_time,1))}}}function E(e){var t,a=e&&null!==(t=Object(y.max)(e.map((function(e){return e.compile_time}))))&&void 0!==t?t:0;return{name:v("compile_time"),key:"Compile_time",fieldName:"compile_time",minWidth:140,maxWidth:200,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.c,{textWidth:70,value:e.compile_time,capacity:a},Object(_.getValueFormat)("s")(e.compile_time,1))}}}function g(e){var t,a=e&&null!==(t=Object(y.max)(e.map((function(e){return e.process_time}))))&&void 0!==t?t:0;return{name:v("process_time"),key:"Process_time",fieldName:"process_time",minWidth:140,maxWidth:200,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.c,{textWidth:70,value:e.process_time,capacity:a},Object(_.getValueFormat)("s")(e.process_time,1))}}}function j(e){var t,a=e&&null!==(t=Object(y.max)(e.map((function(e){return e.memory_max}))))&&void 0!==t?t:0;return{name:v("memory_max"),key:"Mem_max",fieldName:"memory_max",minWidth:140,maxWidth:200,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.c,{textWidth:70,value:e.memory_max,capacity:a},Object(_.getValueFormat)("bytes")(e.memory_max,1))}}}t.a=function(e){var t=e.loading,a=e.slowQueries,d=e.showFullSQL,y=e.onGetColumns,f=Object(n.a)(e,["loading","slowQueries","showFullSQL","onGetColumns"]),_=Object(l.h)(),x=Object(c.useMemo)((function(){return function(e,t){return[h(0,t),{name:v("digest"),key:"Digest",fieldName:"digest",minWidth:100,maxWidth:150,onRender:function(e){return i.a.createElement(s.a,{title:e.digest},i.a.createElement(o.z,null,e.digest))}},{name:v("instance"),key:"instance",fieldName:"instance",minWidth:100,maxWidth:150,onRender:function(e){return i.a.createElement(s.a,{title:e.instance},i.a.createElement(o.z,null,e.instance))}},{name:v("db"),key:"DB",fieldName:"db",minWidth:100,maxWidth:150,onRender:function(e){return i.a.createElement(s.a,{title:e.db},i.a.createElement(o.z,null,e.db))}},{name:v("timestamp"),key:"Time",fieldName:"timestamp",minWidth:100,maxWidth:150,columnActionsMode:b.b.clickable,onRender:function(e){return i.a.createElement(o.z,null,i.a.createElement(o.k.Calendar,{unixTimestampMs:1e3*e.timestamp}))}},k(e),O(e),E(e),g(e),j(e),{name:v("txn_start_ts"),key:"Txn_start_ts",fieldName:"txn_start_ts",minWidth:100,maxWidth:150,onRender:function(e){return i.a.createElement(s.a,{title:e.txn_start_ts},i.a.createElement(o.z,null,e.txn_start_ts))}},{name:v("result"),key:"Succ",fieldName:"success",minWidth:50,maxWidth:100,onRender:function(e){return i.a.createElement(p,{status:1===e.success?"success":"error"})}}]}(a,d)}),[a,d]);Object(c.useEffect)((function(){y&&y(x||[])}),[y,x]);var w=Object(r.f)((function(e,t,a){var n=m.a.buildQuery({digest:e.digest,connectId:e.connection_id,time:e.timestamp});Object(u.a)("/slow_query/detail?".concat(n),a,_)})),q=Object(c.useCallback)((function(e){return"".concat(e.digest,"_").concat(e.timestamp)}),[]);return i.a.createElement(o.f,Object.assign({},f,{loading:t,columns:x,items:a,onRowClicked:w,getKey:q}))}},1542:function(e,t,a){"use strict";a(293);var n=a(139),r=(a(542),a(299)),c=a(0),i=a.n(c),l=a(510),o=a(22),u=a(136),m=a(1568),s=a(21),d=a(49),y=a(111),b=a(1558),f=a(360),_=a(135),p=a(138),v=a(1529);function h(e){var t,a=e.data,n=[{key:"timestamp",value:i.a.createElement(_.k.Calendar,{unixTimestampMs:1e3*(null!==(t=a.timestamp)&&void 0!==t?t:0)})},{key:"digest",value:a.digest},{key:"is_internal",value:a.is_internal},{key:"is_success",value:a.success},{key:"db",value:a.db},{key:"index_names",value:a.index_names},{key:"stats",value:a.stats},{key:"backoff_types",value:a.backoff_types},{key:"memory_max",value:Object(p.getValueFormat)("bytes")(a.memory_max||0,1)},{key:"instance",value:a.instance},{key:"connection_id",value:a.connection_id},{key:"user",value:a.user},{key:"host",value:a.host}],r=Object(v.b)("slow_query.fields.");return i.a.createElement(_.f,{cardNoMargin:!0,columns:r,items:n,extendLastColumn:!0})}a(540);var k=a(359);function O(e){var t=e.data,a=Object(l.a)().t,n=[{key:"parse_time",value:1e9*t.parse_time},{key:"compile_time",value:1e9*t.compile_time},{key:"wait_time",value:1e9*t.wait_time},{key:"process_time",value:1e9*t.process_time},{key:"backoff_time",value:1e9*t.backoff_time},{key:"get_commit_ts_time",value:1e9*t.get_commit_ts_time},{key:"local_latch_wait_time",value:1e9*t.local_latch_wait_time},{key:"resolve_lock_time",value:1e9*t.resolve_lock_time},{key:"prewrite_time",value:1e9*t.prewrite_time},{key:"commit_time",value:1e9*t.commit_time},{key:"commit_backoff_time",value:1e9*t.commit_backoff_time},{key:"query_time2",keyDisplay:i.a.createElement(k.a.Text,{strong:!0},a("slow_query.fields.query_time2")),value:1e9*t.query_time}],r=Object(v.a)("slow_query.fields.",n);return i.a.createElement(_.f,{cardNoMargin:!0,columns:r,items:n,extendLastColumn:!0})}function E(e){var t=e.data,a=[{key:"request_count",value:i.a.createElement(_.x,{value:t.request_count})},{key:"process_keys",value:i.a.createElement(_.x,{value:t.process_keys})},{key:"total_keys",value:i.a.createElement(_.x,{value:t.total_keys})},{key:"cop_proc_addr",value:t.cop_proc_addr},{key:"cop_wait_addr",value:t.cop_wait_addr}],n=Object(v.b)("slow_query.fields.");return i.a.createElement(_.f,{cardNoMargin:!0,columns:n,items:a,extendLastColumn:!0})}function g(e){var t=e.data,a=[{key:"txn_start_ts",value:t.txn_start_ts},{key:"write_keys",value:i.a.createElement(_.x,{value:t.write_keys})},{key:"write_size",value:Object(p.getValueFormat)("bytes")(t.write_size||0,1)},{key:"prewrite_regions",value:i.a.createElement(_.x,{value:t.prewrite_region})},{key:"txn_retry",value:i.a.createElement(_.x,{value:t.txn_retry})}],n=Object(v.b)("slow_query.fields.");return i.a.createElement(_.f,{cardNoMargin:!0,columns:n,items:a,extendLastColumn:!0})}function j(){var e,t=j.parseQuery(Object(o.g)().search),a=Object(l.a)().t,c=Object(y.b)((function(e){return d.b.getInstance().slowQueryDetailGet(t.connectId,t.digest,t.time,{cancelToken:e})})),b=c.data,p=c.isLoading,v=Object(s.i)(!1),k=v.state,x=v.toggle,w=Object(s.i)(!1),q=w.state,W=w.toggle,T=Object(s.i)(!1),C=T.state,S=T.toggle;return i.a.createElement("div",null,i.a.createElement(_.n,{title:a("slow_query.detail.head.title"),back:i.a.createElement(u.b,{to:"/slow_query"},i.a.createElement(m.a,null)," ",a("slow_query.detail.head.back"))},i.a.createElement(_.a,{showSkeleton:p},!b&&i.a.createElement(r.a,{message:"Error",type:"error",showIcon:!0}),!!b&&i.a.createElement(i.a.Fragment,null,i.a.createElement(_.l,null,i.a.createElement(_.l.Item,{span:2,multiline:k,label:i.a.createElement(n.a,{size:"middle"},i.a.createElement(_.y.TransKey,{transKey:"slow_query.detail.head.sql"}),i.a.createElement(_.m.Link,{expanded:k,onClick:function(){return x()}}),i.a.createElement(_.i,{data:Object(f.a)(b.query)}))},i.a.createElement(_.m,{expanded:k,collapsedContent:i.a.createElement(_.o,{sql:b.query,compact:!0})},i.a.createElement(_.o,{sql:b.query}))),function(){if(b.prev_stmt&&0!==b.prev_stmt.length)return i.a.createElement(_.l.Item,{span:2,multiline:q,label:i.a.createElement(n.a,{size:"middle"},i.a.createElement(_.y.TransKey,{transKey:"slow_query.detail.head.previous_sql"}),i.a.createElement(_.m.Link,{expanded:q,onClick:function(){return W()}}),i.a.createElement(_.i,{data:Object(f.a)(b.prev_stmt)}))},i.a.createElement(_.m,{expanded:q,collapsedContent:i.a.createElement(_.o,{sql:b.prev_stmt,compact:!0})},i.a.createElement(_.o,{sql:b.prev_stmt})))}(),i.a.createElement(_.l.Item,{span:2,multiline:C,label:i.a.createElement(n.a,{size:"middle"},i.a.createElement(_.y.TransKey,{transKey:"slow_query.detail.head.plan"}),i.a.createElement(_.m.Link,{expanded:C,onClick:function(){return S()}}),i.a.createElement(_.i,{data:null!==(e=b.plan)&&void 0!==e?e:""}))},i.a.createElement(_.m,{expanded:C},i.a.createElement(_.v,{noWrap:!0},b.plan)))),i.a.createElement(_.g,{animated:!1},i.a.createElement(_.g.TabPane,{tab:a("slow_query.detail.tabs.basic"),key:"basic"},i.a.createElement(h,{data:b})),i.a.createElement(_.g.TabPane,{tab:a("slow_query.detail.tabs.time"),key:"time"},i.a.createElement(O,{data:b})),i.a.createElement(_.g.TabPane,{tab:a("slow_query.detail.tabs.copr"),key:"copr"},i.a.createElement(E,{data:b})),i.a.createElement(_.g.TabPane,{tab:a("slow_query.detail.tabs.txn"),key:"txn"},i.a.createElement(g,{data:b})))))))}j.buildQuery=Object(b.a)(),j.parseQuery=Object(b.b)();t.a=j},1558:function(e,t,a){"use strict";function n(){return function(e){var t=new URLSearchParams(e).get("query");if(null==t)return{};var a=JSON.parse(t);return a&&a.constructor===Object?a:{}}}function r(){return function(e){var t=JSON.stringify(e),a=new URLSearchParams;return a.set("query",t),a.toString()}}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}))},1559:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(11),r=a(0),c=a(21);function i(e,t,a){var i="".concat(e,".order_options"),l=Object(r.useState)(a),o=Object(n.a)(l,2),u=o[0],m=o[1],s=Object(c.d)(i,a),d=Object(n.a)(s,2),y=d[0],b=d[1];return{orderOptions:Object(r.useMemo)((function(){return t?y:u}),[t,u,y]),changeOrder:function(e,a){t?b({orderBy:e,desc:a}):m({orderBy:e,desc:a})}}}}}]);
//# sourceMappingURL=2.87a000b7.chunk.js.map