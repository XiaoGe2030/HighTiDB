(this["webpackJsonptidb-dashboard-ui"]=this["webpackJsonptidb-dashboard-ui"]||[]).push([[9],{1641:function(e,t,n){},1669:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(135),i=(n(1556),n(1566)),o=(n(1557),n(1567)),s=(n(137),n(37)),c=n(11),u=n(32),d=n.n(u),v=n(66),f=n(31),h=n(53),p=n(510),m=n(1675),y=n(1683),g=n(1496),b=n(21),x=n(49),k=n(1534),w=n(94),O=n(75),j=n.n(O);function E(e,t,n,a){var l=k.d("canvas").attr("width",t).attr("height",n).node();console.time("createBuffer");for(var r=l.getContext("2d"),i=new ArrayBuffer(t*n*4),o=new Uint32Array(i),s=e.length,c=0;c<s;c++)o[c]=a[e[c]];var u=r.createImageData(t,n);return u.data.set(new Uint8ClampedArray(i)),r.putImageData(u,0,0),console.timeEnd("createBuffer"),l}var C=n(39);function P(e,t,n,a,l){var r,i=[],o=null,s=!1,c=Object(C.a)(e);try{for(c.s();!(r=c.n()).done;){var u=r.value,d=n[0],v=n[1],f=a(u.startIdx),h=a(u.endIdx),p=Math.max(f,d),m=Math.min(h,v),y=!!t&&Math.min(a(t[1]),h)-Math.max(a(t[0]),f)>0;o&&(o.endPos-o.startPos>=3||p-o.startPos>3||!s&&u.startIdx%2===0)&&(i.push(o),s=!0,o=null),m-p>0&&(m-p>3?(i.push(j.a.assign({startPos:p,endPos:m,focus:y},u)),s=!0,o=null):null===o?o=j.a.assign({startPos:p,endPos:m,focus:y},u):(o.val=l(o.val,u.val),o.endPos=m,o.focus=o.focus||y))}}catch(g){c.e(g)}finally{c.f()}return i}function A(e){switch(e){case"integration":case"read_bytes":case"written_bytes":return"bytes/min";case"read_keys":case"written_keys":return"keys/min"}}function _(e){return(e=e||0)>1073741824?(e/1024/1024/1024).toFixed(2)+" G":e>1048576?(e/1024/1024).toFixed(2)+" M":e>1024?(e/1024).toFixed(2)+" K":e.toFixed(2)}function M(e,t){e.each((function(e){k.l(this).on("click",(function(){!function(e){var t=k.l("body").append("input").attr("value",e);t.node().select(),document.execCommand("copy"),t.remove()}(t(e))}))}))}function R(e){e.length>1&&(e=e.slice(1));var t=[0,0],n=function(e){for(var t=j.a.times(4,(function(){return[]})),n=j.a.times(e.length,(function(){return!1})),a=0;a<t.length;a++){for(var l=null,r=null,i=0;i<e.length;i++){var o=e[i].labels[a];n[i]=n[i]||null!=o&&o!==l,n[i]&&(null!=r&&null!=l&&(t[a].push({val:l,startIdx:r,endIdx:i}),r=null),null!=o&&(r=i),l=o)}null!=r&&null!=l&&t[a].push({val:l,startIdx:r,endIdx:e.length})}return t}(e);function a(e,a,l){var r=e.canvas.width,i=e.canvas.height,o=n.map((function(e){return P(e,a,t,l,(function(){return""}))}));e.clearRect(0,0,r,i),e.strokeStyle="#fff",e.lineWidth=1,e.textBaseline="middle";var s,u=Object(C.a)(o.entries());try{for(u.s();!(s=u.n()).done;){var d,v=Object(c.a)(s.value,2),f=v[0],h=v[1],p=32*f,m=Object(C.a)(h);try{for(m.s();!(d=m.n()).done;){var y=d.value,g=y.endPos-y.startPos;e.fillStyle=y.focus?"#ccc":"#333",e.beginPath(),e.rect(p,y.startPos,28,g),e.fill(),e.stroke(),e.closePath(),z(y)&&(e.font=y.focus?"700 12px Poppins":"500 12px Poppins",e.fillStyle=y.focus?"#333":"white",e.translate(p+14+2,y.endPos-4),e.rotate(-Math.PI/2),e.fillText(S(y),0,0),e.resetTransform(),e.scale(window.devicePixelRatio,window.devicePixelRatio))}}catch(b){m.e(b)}finally{m.f()}}}catch(b){u.e(b)}finally{u.f()}}return a.range=function(e){return t=e,this},a}function z(e){var t;return e.endPos-e.startPos>=17&&0!==(null===(t=e.val)||void 0===t?void 0:t.length)}function S(e){var t,n,a=e.endPos-e.startPos,l=Math.floor(a/7.5);return t=e.val,n=l,t.length>n?t.substr(0,n/2-1)+"...."+t.substr(t.length-n/2+1,t.length):t}function T(e){var t=[0,0],n=[0,0];function a(a,l,r,i,o,s){for(var c=a.canvas.height,u=l.canvas.width,d=e.length,v=e[0].length,f=Math.max(0,Math.floor(o.invert(t[0]))),h=Math.min(d-1,Math.ceil(o.invert(t[1]))),p=Math.max(0,Math.floor(s.invert(n[0]))),m=Math.min(v-1,Math.ceil(s.invert(n[1]))),y=[],g=[],b=f;b<h;b++){for(var x=0,w=p;w<m;w++)x+=e[b][w];y.push({val:x,startIdx:b,endIdx:b+1})}for(var O=p;O<m;O++){for(var j=0,E=f;E<h;E++)j+=e[E][O];g.push({val:j,startIdx:O,endIdx:O+1})}var A=P(y,r,t,o,(function(e,t){return e+t})),_=P(g,i,n,s,(function(e,t){return e+t})),M=k.h(A,(function(e){return e.val})),R=k.h(_,(function(e){return e.val}));a.clearRect(t[0],0,t[1],c),a.strokeStyle="#fff",a.lineWidth=1;var z,S=Object(C.a)(A);try{for(S.s();!(z=S.n()).done;){var T=z.value,I=T.endPos-T.startPos,D=T.val/M*c;D<1||(a.fillStyle=T.focus?"#ccc":"#333",a.beginPath(),a.rect(T.startPos,c-D,I,D),a.fill(),a.stroke(),a.closePath())}}catch(X){S.e(X)}finally{S.f()}l.clearRect(0,n[0],u,n[1]),l.strokeStyle="#fff",l.lineWidth=1;var B,F=Object(C.a)(_);try{for(F.s();!(B=F.n()).done;){var V=B.value,L=V.val/R*u,Y=V.endPos-V.startPos;L<1||(l.fillStyle=V.focus?"#ccc":"#333",l.beginPath(),l.rect(u-L,V.startPos,L,Y),l.fill(),l.stroke(),l.closePath())}}catch(X){F.e(X)}finally{F.f()}}return a.xRange=function(e){return t=e,this},a.yRange=function(e){return n=e,this},a}var I=k.g(["#000000","#080808","#090909","#101010","#111111","#121212","#131313","#141414","#151515","#171717","#181818","#191919","#410c74","#72067b","#b00f53","#fcc734","#fbfc43","#ffffb0"]);function D(e,t){for(var n=k.k().domain([0,e/t]),a=function(e){return k.c(I(n(e)))},l=new Uint32Array(101),r=0;r<=100;r++){var i=k.c(a(Math.pow(e,r/100))).rgb();l[r]=i.r|i.g<<8|i.b<<16|4278190080}return{background:a,label:function(e){return k.f(a(e)).l>.5?k.c("black"):k.c("white")},maxValue:e,rasterizedColors:l}}var B=function(e,t){if(null!==document.querySelector(".PD-Cluster-Legend")){for(var n=k.l(".PD-Cluster-Legend").style("width","".concat(500,"px")).style("height","".concat(50,"px")),a=k.k().domain([e.maxValue/1e3,e.maxValue]).range([0,380]),l=n.selectAll("canvas").data([null]),r=(l=l.enter().append("canvas").style("position","absolute").style("left","0px").style("top","0px").merge(l).attr("width",500).attr("height",50)).node().getContext("2d"),i=0;i<380;i++)r.fillStyle=e.background(a.invert(i)).toString(),r.fillRect(i,0,1,26);var o=k.a(a).tickValues(j.a.range(0,6).map((function(e){return a.invert(380*e/5)}))).tickSize(26).tickFormat((function(e){return _(e)})),s=n.selectAll("svg").data([null]),c=(s=s.enter().append("svg").style("position","absolute").style("left","0px").style("top","0px").merge(s).attr("width",500).attr("height",50)).selectAll("g").data([null]);c.enter().append("g").merge(c).call(o).call((function(e){e.selectAll(".tick text").attr("y",32),e.selectAll(".domain").remove()}));var u=n.selectAll("div").data([null]);u.enter().append("div").classed("unit",!0).merge(u).text(A(t))}},F=25,V=40,L=70,Y=100,X=20,N=20,G={pinned:!1,hidden:!0,x:0,y:0},K=Math.max(2,window.devicePixelRatio);function W(e,t){for(var n=e.length>0?e[0].length:0,a=e.length,l=new Uint8Array(a*n),r=Math.log(t),i=0;i<a;i++)for(var o=0;o<n;o++){l[o*a+i]=Math.log(e[i][o])/r*100}return l}function U(e,t,n,a,l){return H.apply(this,arguments)}function H(){return(H=Object(v.a)(d.a.mark((function e(t,n,a,l,r){var i,o,s,c,u,v,f,h,p,m,y,g,b,x,O;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O=function(){var e=t.selectAll("canvas.x-histogram").data([null]);(e=e.enter().append("canvas").classed("x-histogram",!0).style("position","absolute").style("z-index","100").merge(e).attr("width",g*window.devicePixelRatio).attr("height",b*window.devicePixelRatio).style("width",g+"px").style("height","30px").style("margin-top",y-60+"px").style("margin-left",Y+"px")).node().getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);var i=t.selectAll("canvas.y-histogram").data([null]);(i=i.enter().append("canvas").classed("y-histogram",!0).style("position","absolute").style("z-index","101").merge(i).attr("width",30*window.devicePixelRatio).attr("height",b*window.devicePixelRatio).style("width","30px").style("height",b+"px").style("margin-top",F+"px").style("margin-left",m-30+"px")).node().getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);var o=t.selectAll("canvas.label").data([null]);(o=o.enter().append("canvas").classed("label",!0).style("position","absolute").style("z-index","102").merge(o).style("width","90px").style("height",b+"px").attr("width",90*window.devicePixelRatio).attr("height",b*window.devicePixelRatio).style("margin-top",F+"px")).node().getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);var c=t.selectAll("canvas.heatmap").data([null]),d=(c=c.enter().append("canvas").classed("heatmap",!0).style("position","absolute").style("z-index","103").merge(c).attr("width",g*K).attr("height",b*K).style("width",g+"px").style("height",b+"px").style("margin-top",F+"px").style("margin-right",V+"px").style("margin-bottom",L+"px").style("margin-left",Y+"px")).node().getContext("2d");d.imageSmoothingEnabled=!1,d.scale(K,K);var x=t.selectAll("svg").data([null]);x=x.enter().append("svg").style("position","absolute").style("z-index","200").merge(x).style("width",m+"px").style("height",y+"px");var O=t.selectAll("div").data([null]);O=O.enter().append("div").style("position","absolute").style("z-index","300").style("pointer-events","none").merge(O).style("width",m+"px").style("height",y+"px");var E=k.j().domain([0,n.timeAxis.length-1]).range([0,g]),C=k.j().domain([0,n.keyAxis.length-1]).range([0,b]),P=k.a(E).tickFormat((function(e){return void 0!==n.timeAxis[e]?k.m("%Y-%m-%d %H:%M:%S")(new Date(1e3*n.timeAxis[e])):""})).ticks(m/270),z=R(n.keyAxis).range([0,b]),S=T(n.data[a]).xRange([0,g]).yRange([0,b]),I=x.selectAll("g.x-axis").data([null]);I=I.enter().append("g").classed("x-axis",!0).merge(I).attr("transform","translate("+Y+","+(y-20)+")"),k.n().transform(x,v);var D=k.n().scaleExtent([1,128]).on("zoom",(function(){r(),k.e.sourceEvent&&"mousemove"===k.e.sourceEvent.type?(v=function(e){var t=Math.max(0,e.applyX(0)),n=Math.max(0,g-e.applyX(g)),a=Math.max(0,e.applyY(0)),l=Math.max(0,b-e.applyY(b));return k.o.translate(Math.floor(e.x-.8*(t-n)),Math.floor(e.y-.8*(a-l))).scale(e.k)}(k.e.transform),U()):(v=G(k.e.transform),W());H()})).on("end",(function(){v=G(v),x.call(k.n().transform,v),f.pinned&&W();H()}));function G(e){var t=e.invertX(0),n=e.invertX(g)-g,a=e.invertY(0),l=e.invertY(b)-b;return e.translate(n>t?(t+n)/2:Math.min(0,t)||Math.max(0,n),l>a?(a+l)/2:Math.min(0,a)||Math.max(0,l))}function W(){if(f.hidden=!1,!f.pinned){var e=k.i(c.node());if(isNaN(e[0]))return;var t=v.rescaleX(E),n=v.rescaleY(C),a=t.invert(e[0]),l=n.invert(e[1]);p||function(e,t){h={xDomain:[e,e+.001],yDomain:[t,t+.001]}}(a,l),e[0]<0||e[0]>g||e[1]<0||e[1]>b?U():(f.x=a,f.y=l)}}function U(){f.hidden=!0}function H(){d.clearRect(0,0,g,b),d.drawImage(u,E.invert(v.invertX(0)),C.invert(v.invertY(0)),E.invert(g*(1/v.k)),C.invert(b*(1/v.k)),0,0,g,b),function(){var t,n,a,l=v.rescaleX(E),r=v.rescaleY(C);S(e.node().getContext("2d"),i.node().getContext("2d"),null===(t=h)||void 0===t?void 0:t.xDomain,null===(n=h)||void 0===n?void 0:n.yDomain,l,r),z(o.node().getContext("2d"),null===(a=h)||void 0===a?void 0:a.yDomain,r),I.call(P.scale(l)),x.selectAll(".tick text").each((function(){""===this.innerHTML&&(this.parentNode.style.display="none")}))}(),function(){if(p){var e=k.b().extent([[0,0],[g,b]]).on("start",(function(){U(),H()})).on("brush",(function(){var e=k.e.selection;if(e){var t=v.rescaleX(E),n=v.rescaleY(C);h={xDomain:[t.invert(e[0][0]),t.invert(e[1][0])],yDomain:[n.invert(e[0][1]),n.invert(e[1][1])]},H()}})).on("end",(function(){t.remove(),p=!1;var a=k.e.selection;if(a){e.move(t,null);var r=v.rescaleX(E),i=v.rescaleY(C),o=n.timeAxis[Math.floor(r.invert(a[0][0]))],s=n.timeAxis[Math.ceil(r.invert(a[1][0]))],c=n.keyAxis[Math.ceil(i.invert(a[1][1]))].key,u=n.keyAxis[Math.floor(i.invert(a[0][1]))].key;l({starttime:o,endtime:s,startkey:c,endkey:u})}W(),H()})),t=x.selectAll("g.brush").data([null]);t=t.enter().append("g").classed("brush",!0).merge(t).attr("transform","translate("+Y+","+F+")").call(e)}else x.selectAll("g.brush").remove()}(),function(){var e,t;if(f.hidden)return void O.selectAll("div").remove();var l=Math.floor(f.x),r=Math.floor(f.y);if(null==n.keyAxis[r]||null==n.keyAxis[r+1])return;if(null==n.timeAxis[l]||null==n.timeAxis[l+1])return;var i=v.rescaleX(E),o=v.rescaleY(C),c=[i(f.x),o(f.y)],u=O.selectAll("div").data([null]);if(u=u.enter().append("div").style("position","absolute").classed("tooltip",!0).merge(u).style("pointer-events",f.pinned?"all":"none"),c[0]<g/2){var d=c[0]+X+Y;u.style("left","".concat(d,"px")).style("right","auto")}else{var h=g-c[0]+X+V;u.style("right","".concat(h,"px")).style("left","auto")}if(c[1]<b/2){var p=c[1]+N+F;u.style("top","".concat(p,"px")).style("bottom","auto")}else{var m=b-c[1]+N+L;u.style("bottom","".concat(m,"px")).style("top","auto")}var y=null===(e=n.data[a])||void 0===e||null===(t=e[l])||void 0===t?void 0:t[r],x=u.selectAll("div.value").data([null]),P=(x=x.enter().append("div").classed("value",!0).merge(x)).selectAll("div.value").data([null]);P.enter().append("div").classed("value",!0).merge(P).text(_(y)).style("color",s.label(y)).style("background-color",s.background(y));var R=x.selectAll("div.unit").data([null]);R.enter().append("div").classed("unit",!0).merge(R).text(A(a));var z=[l,l+1].map((function(e){return k.m("%Y-%m-%d\n%H:%M:%S")(new Date(1e3*n.timeAxis[e]))})).join(" ~ "),S=u.selectAll("button.time").data([z]);S.enter().append("button").classed("time",!0).merge(S).call(M,(function(e){return e})).text((function(e){return e}));var T=u.selectAll("div.overviewLabel").data([r+1]),I=(T=T.enter().append("div").classed("overviewLabel",!0).merge(T)).selectAll(".subLabel").style("display","none").data((function(e){return function(e){var t=n.keyAxis[e].labels,a=n.keyAxis[e-1].labels;if(!t&&!a)return[];if(!t)return a;if(!a||j.a.isEqual(t,a))return t;var l=t.length,r=a.length;if(l>=1&&l+1===r&&j.a.isEqual(t,a.slice(0,l)))return a;if(l>=3&&l===r&&j.a.isEqual(t.slice(0,l-1),a.slice(0,l-1)))return[].concat(Object(w.a)(t.slice(0,l-1)),["".concat(t[l-1]," ~ ").concat(a[l-1])]);return t}(e)}));I.enter().append("button").classed("subLabel",!0).merge(I).call(M,(function(e){return e})).text((function(e,t){return"\xa0".repeat(2*t)+e})).style("display","block");var D=u.selectAll("div.keyContainer").data([{desc:"Start Key (Incl.):",idx:r+1},{desc:"End key (Excl.):",idx:r}]),B=(D=D.enter().append("div").classed("keyContainer",!0).merge(D)).selectAll(".desc").data((function(e){return[e]}));B.enter().append("div").classed("desc",!0).merge(B).text((function(e){return e.desc}));var G=D.selectAll("button.key").data((function(e){return[e]}));G.enter().append("button").classed("key",!0).merge(G).call(M,(function(e){var t=e.idx;return n.keyAxis[t].key})).text((function(e){var t=e.idx;return n.keyAxis[t].key}))}(),function(){if(f.pinned){var e=v.rescaleX(E),t=v.rescaleY(C),n=[e(f.x),t(f.y)];d.lineWidth=4,d.strokeStyle="#111",d.beginPath(),d.moveTo(n[0],n[1]-8-1),d.lineTo(n[0],n[1]-3+1),d.moveTo(n[0],n[1]+3-1),d.lineTo(n[0],n[1]+8+1),d.moveTo(n[0]-8-1,n[1]),d.lineTo(n[0]-3+1,n[1]),d.moveTo(n[0]+3-1,n[1]),d.lineTo(n[0]+8+1,n[1]),d.stroke(),d.lineWidth=2,d.strokeStyle="#eee",d.beginPath(),d.moveTo(n[0],n[1]-8),d.lineTo(n[0],n[1]-3),d.moveTo(n[0],n[1]+3),d.lineTo(n[0],n[1]+8),d.moveTo(n[0]-8,n[1]),d.lineTo(n[0]-3,n[1]),d.moveTo(n[0]+3,n[1]),d.lineTo(n[0]+8,n[1]),d.stroke()}}(),B(s,a)}x.on("click",(function(){if(k.e.defaultPrevented)return;var e=k.i(c.node());if(e[0]<0||e[0]>g||e[1]<0||e[1]>b)return;f.pinned=!f.pinned,W(),H()})),x.call(D),x.call((function(e){e.on("mousemove",(function(){W(),H()})),e.on("mouseout",(function(){f.pinned||p||(h=null,H())}))})),H()},x=function(){var e=n.data[a],t=e.length>0?e[0].length:0,l=e.length,r=D(i,c);u=E(o,l,t,r.rasterizedColors),s=r},i=k.h(n.data[a].map((function(e){return k.h(e)})))||0,o=W(n.data[a],i),c=1,v=k.o,f=j.a.clone(G),h=null,p=!1,m=0,y=0,g=0,b=0,O.brightness=function(e){c=e,x(),O()},O.brush=function(e){p=e,O()},O.resetZoom=function(){v=k.o,O()},O.size=function(e,t){var n=e-Y-V,a=t-F-L;0!==g&&0!==b&&(v=k.o.translate(v.x*n/g,v.y*a/b).scale(v.k)),m=e,y=t,g=n,b=a,O()},x(),O(),e.abrupt("return",O);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=l.a.memo((function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null);function r(){if(null!=t.current&&n.current){var e=t.current,a=e.offsetWidth,l=e.offsetHeight;n.current.size(a,l)}}return Object(a.useEffect)((function(){(function(){var a=Object(v.a)(d.a.mark((function a(){var l;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null==t.current){a.next=7;break}return l=t.current,a.next=4,U(k.l(l),e.data,e.dataTag,e.onBrush,e.onZoom);case 4:n.current=a.sent,e.onChartInit(n.current),r();case 7:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}})()()}),[e,e.data,e.dataTag]),Object(b.c)("resize",(function(){r()})),l.a.createElement("div",{className:"heatmap",ref:t})}));function q(e){return J.apply(this,arguments)}function J(){return(J=Object(v.a)(d.a.mark((function e(t){var n,a,l=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:"written_bytes",e.next=3,x.b.getInstance().keyvisualHeatmapsGet(null===t||void 0===t?void 0:t.startkey,null===t||void 0===t?void 0:t.endkey,null===t||void 0===t?void 0:t.starttime,null===t||void 0===t?void 0:t.endtime,n);case 3:return Q((a=e.sent).data),e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){for(var t in e.keyAxis.reverse(),e.data){var n,a=e.data[t],l=Object(C.a)(a);try{for(l.s();!(n=l.n()).done;){n.value.reverse()}}catch(r){l.e(r)}finally{l.f()}}}n(293);var $=n(139),ee=(n(294),n(193)),te=(n(1540),n(1543)),ne=(n(544),n(364)),ae=(n(538),n(142)),le=(n(537),n(358)),re=n(1),ie=(n(1635),n(1637)),oe=n(1665),se={getValueProps:function(e){return{checked:!0!==e}},getValueFromEvent:function(e){return!e}};var ce=function(e){var t=e.onClose,n=e.onConfigUpdated,r=Object(a.useState)(!0),i=Object(c.a)(r,2),o=i[0],u=i[1],d=Object(a.useState)(!1),v=Object(c.a)(d,2),f=v[0],h=v[1],m=Object(a.useState)(null),y=Object(c.a)(m,2),g=y[0],b=y[1],k=Object(p.a)().t,w=function(){x.b.getInstance().keyvisualConfigGet().then((function(e){b(Object(re.a)({},e.data)),h(!1),t(),setTimeout(n,500)}),(function(){h(!1)}))},O=function(e){h(!0),x.b.getInstance().keyvisualConfigPut(e).then(w,w)};Object(a.useEffect)((function(){u(!0),x.b.getInstance().keyvisualConfigGet().then((function(e){b(Object(re.a)({},e.data)),u(!1)}),(function(){u(!1)}))}),[]);var j=ae.a.useForm(),E=Object(c.a)(j,1)[0],C=Object(a.useCallback)((function(e,t){!0===(null===e||void 0===e?void 0:e.auto_collection_disabled)||(null===t||void 0===t?void 0:t.policy)||E.setFieldsValue({policy:"db"}),"kv"===(null===g||void 0===g?void 0:g.policy)||"kv"!==(null===e||void 0===e?void 0:e.policy)||(null===t||void 0===t?void 0:t.policy_kv_separator)||E.setFieldsValue({policy_kv_separator:"/"})}),[E,g]),P=Object(a.useMemo)((function(){return function(e){return["db","kv"].map((function(t){var n=e("keyviz.settings.policy_".concat(t));return l.a.createElement(ie.default.Button,{key:t,value:t},n)}))}(k)}),[k]),A=Object(a.useMemo)((function(){return function(e){var t={validateStatus:"warning",hasFeedback:!0,help:e("keyviz.settings.separator_empty_warning")},n={validateStatus:"success",hasFeedback:!0,help:""};return function(e){return void 0===e||""===e?t:n}}(k)}),[k]);return l.a.createElement(l.a.Fragment,null,o&&l.a.createElement(ne.a,{active:!0,paragraph:{rows:5}}),!o&&g&&l.a.createElement(ae.a,{layout:"vertical",form:E,initialValues:g,onFinish:function(e){!0!==(null===g||void 0===g?void 0:g.auto_collection_disabled)&&!0===e.auto_collection_disabled?le.a.confirm({title:k("keyviz.settings.close_keyviz"),icon:l.a.createElement(oe.a,null),content:k("keyviz.settings.close_keyviz_warning"),okText:k("keyviz.settings.actions.close"),cancelText:k("keyviz.settings.actions.cancel"),okButtonProps:{danger:!0},onOk:function(){return O(e)}}):O(e)},onValuesChange:C},l.a.createElement(ae.a.Item,{noStyle:!0,shouldUpdate:!0},(function(e){var t=e.getFieldValue,n=(t("auto_collection_disabled"),t("policy"),t("policy_kv_separator"));return l.a.createElement(l.a.Fragment,null,l.a.createElement(ae.a.Item,Object.assign({name:"auto_collection_disabled",label:k("keyviz.settings.switch")},se),l.a.createElement(te.a,null)),l.a.createElement(ae.a.Item,{name:"policy",label:k("keyviz.settings.policy"),style:{display:"none"}},l.a.createElement(ie.default.Group,null,P)),l.a.createElement(ae.a.Item,Object.assign({name:"policy_kv_separator",label:k("keyviz.settings.separator"),style:{display:"none"}},A(n)),l.a.createElement(ee.a,{placeholder:k("keyviz.settings.separator_placeholder")})))})),l.a.createElement(ae.a.Item,null,l.a.createElement($.a,null,l.a.createElement(s.a,{type:"primary",htmlType:"submit",loading:f},k("keyviz.settings.actions.save")),l.a.createElement(s.a,{onClick:t},k("keyviz.settings.actions.cancel"))))))},ue=(n(110),n(44)),de=(n(1638),n(1640)),ve=(n(1531),n(1535)),fe=(n(361),n(221)),he=(n(1539),n(1541)),pe=(n(372),n(127)),me=n(69),ye=n(70),ge=n(1677),be=n(1506),xe=n(1678),ke=n(1511),we=n(1679),Oe=n(1680),je=n(1510),Ee=n(1676),Ce=n(1667),Pe=n(54),Ae=n(473),_e=n.n(Ae),Me=n(138);function Re(e){var t=e.value,n=2*Math.PI*50,r=Object(Pe.b)((function(){return{value:0}})),i=Object(c.a)(r,2),o=i[0],s=i[1];return Object(a.useEffect)((function(){s({value:t})}),[s,t]),l.a.createElement("svg",{viewBox:"0 0 120 120",width:"1em",height:"1em",className:"anticon",style:{transform:"rotate(-90deg)"}},l.a.createElement("circle",{cx:"60",cy:"60",r:50,fill:"none",stroke:"#eee",strokeWidth:"20"}),l.a.createElement(Pe.a.circle,{cx:"60",cy:"60",r:50,fill:"none",stroke:o.value.interpolate({range:[0,1],output:["#989CAB","#4571FF"]}),strokeWidth:"20",strokeDasharray:n,strokeDashoffset:o.value.interpolate({range:[0,1],output:[n,0]})}))}var ze,Se=function(e){Object(me.a)(n,e);var t=Object(ye.a)(n);function n(){var e;Object(f.a)(this,n);for(var a=arguments.length,l=new Array(a),r=0;r<a;r++)l[r]=arguments[r];return(e=t.call.apply(t,[this].concat(l))).state={exp:0},e.handleRefreshClick=function(){e.props.onRefresh()},e.handleAutoRefreshMenuClick=function(t){var n=t.key;e.props.onChangeAutoRefresh(parseInt(n))},e.handleDateRange=function(t){e.props.onChangeDateRange(t)},e.handleMetricChange=function(t){e.props.onChangeMetric(t)},e.handleBrightLevel=function(t){e.props.onChangeBrightLevel(Math.pow(2,t)),e.setState({exp:t})},e.handleBrightnessDropdown=function(){setTimeout((function(){e.handleBrightLevel(e.state.exp)}),0)},e}return Object(h.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.t,a=t.enabled,i=t.dateRange,o=t.isOnBrush,c=t.metricType,u=t.remainingRefreshSeconds,d=t.autoRefreshSeconds,v=t.onShowSettings,f=[{text:n("keyviz.toolbar.view_type.read_bytes"),value:"read_bytes"},{text:n("keyviz.toolbar.view_type.write_bytes"),value:"written_bytes"},{text:n("keyviz.toolbar.view_type.read_keys"),value:"read_keys"},{text:n("keyviz.toolbar.view_type.write_keys"),value:"written_keys"},{text:n("keyviz.toolbar.view_type.all"),value:"integration"}],h=l.a.createElement(pe.a,{onClick:this.handleAutoRefreshMenuClick,selectedKeys:[String(this.props.autoRefreshSeconds||0)]},l.a.createElement(pe.a.ItemGroup,{title:n("keyviz.toolbar.auto_refresh.title")},l.a.createElement(pe.a.Item,{key:"0"},n("keyviz.toolbar.auto_refresh.off")),l.a.createElement(pe.a.Divider,null),[15,30,60,120,300,600].map((function(e){return l.a.createElement(pe.a.Item,{key:String(e)},Object(Me.getValueFormat)("s")(e,0))}))));return l.a.createElement(r.e,null,l.a.createElement(r.B,{className:"PD-KeyVis-Toolbar"},l.a.createElement($.a,null,l.a.createElement(fe.a,{disabled:!a,overlay:l.a.createElement("div",{id:"PD-KeyVis-Brightness-Overlay"},l.a.createElement("div",{onClick:function(e){e.stopPropagation()}},l.a.createElement(_e.a,{flexDirection:"column"},l.a.createElement("div",{className:"PD-Cluster-Legend"}),l.a.createElement(he.a,{defaultValue:0,min:-6,max:6,step:.1,onChange:function(t){return e.handleBrightLevel(t)}})))),trigger:["click"],onVisibleChange:this.handleBrightnessDropdown},l.a.createElement(s.a,{icon:l.a.createElement(ge.a,null)},n("keyviz.toolbar.brightness"),l.a.createElement(be.a,null))),l.a.createElement(s.a.Group,null,l.a.createElement(s.a,{disabled:!a,onClick:this.props.onToggleBrush,icon:l.a.createElement(xe.a,null),type:o?"primary":"default"},n("keyviz.toolbar.zoom.select")),l.a.createElement(s.a,{disabled:!a,onClick:this.props.onResetZoom},n("keyviz.toolbar.zoom.reset"))),l.a.createElement(ve.a,{disabled:!a,onChange:this.handleDateRange,value:i,style:{width:150}},[1,6,12,24,168].map((function(e){return l.a.createElement(ve.a.Option,{key:e,value:60*e*60,className:"PD-KeyVis-Select-Option"},l.a.createElement(ke.a,null)," ",Object(Me.getValueFormat)("h")(e,0))}))),l.a.createElement(ve.a,{disabled:!a,onChange:this.handleMetricChange,value:c,style:{width:160}},f.map((function(e){return l.a.createElement(ve.a.Option,{key:e.text,value:e.value,className:"PD-KeyVis-Select-Option"},l.a.createElement(we.a,null)," ",e.text)}))),l.a.createElement(fe.a.Button,{disabled:!a,onClick:this.handleRefreshClick,overlay:h,trigger:["click"],icon:l.a.createElement(be.a,null)},d?l.a.createElement(Re,{value:1-(u||0)/d}):l.a.createElement(Oe.a,null),n("keyviz.toolbar.refresh")),this.props.isLoading&&l.a.createElement(de.a,{indicator:l.a.createElement(je.a,{style:{fontSize:24},spin:!0})})),l.a.createElement($.a,null,l.a.createElement(ue.a,{title:n("keyviz.settings.title")},l.a.createElement(Ee.a,{onClick:v})))))}}]),n}(a.Component),Te=Object(Ce.a)()(Se),Ie=(n(1641),new(function(){function e(){Object(f.a)(this,e)}return Object(h.a)(e,[{key:"fetch",value:function(){var e=Object(v.a)(d.a.mark((function e(t,n){var a,l,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"number"===typeof t?(l=Math.ceil((new Date).getTime()/1e3),a={starttime:l-t,endtime:l}):a=t,e.next=3,q(a,n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}())),De=function(){var e=Object(a.useState)(),t=Object(c.a)(e,2),n=t[0],r=t[1],u=Object(m.a)(null),f=Object(c.a)(u,2),h=f[0],k=f[1],w=Object(a.useState)(!0),O=Object(c.a)(w,2),j=O[0],E=O[1],C=Object(m.a)(0),P=Object(c.a)(C,2),A=P[0],_=P[1],M=Object(m.a)(0),R=Object(c.a)(M,2),z=R[0],S=R[1],T=Object(m.a)(!1),I=Object(c.a)(T,2),D=I[0],B=I[1],F=Object(m.a)(21600),V=Object(c.a)(F,2),L=V[0],Y=V[1],X=Object(m.a)(1),N=Object(c.a)(X,2),G=N[0],K=N[1],W=Object(m.a)("written_bytes"),U=Object(c.a)(W,2),H=U[0],q=U[1],J=Object(a.useState)(null),Q=Object(c.a)(J,2),$=Q[0],ee=Q[1],te=Object(b.a)(!1),ne=te.state,ae=te.setTrue,le=te.setFalse,re=Object(p.a)().t,ie=!0!==(null===$||void 0===$?void 0:$.auto_collection_disabled),oe=Object(a.useCallback)(Object(v.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!0),e.prev=1,e.next=4,x.b.getInstance().keyvisualConfigGet();case 4:t=e.sent,n=t.data,!0!==(null===n||void 0===n?void 0:n.auto_collection_disabled)||_(0),ee(n),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(1);case 13:E(!1);case 14:case"end":return e.stop()}}),e,null,[[1,11]])}))),[]);Object(y.a)(oe);var se=Object(a.useCallback)(Object(v.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A()>0&&S(A()),E(!0),B(!1),e.prev=3,t=H(),e.next=7,Ie.fetch(h()||L(),t);case 7:n=e.sent,r({heatmapData:n,metricType:t}),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(3);case 13:E(!1);case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),[]),ue=Object(a.useCallback)((function(e){ze&&(K(e),ze.brightness(e))}),[]),de=Object(a.useCallback)((function(e){Y(e),k(null)}),[]),ve=Object(a.useCallback)((function(){k(null)}),[]),fe=Object(a.useCallback)((function(){var e=!D();_(0),B(e),ze.brush(e)}),[]),he=Object(a.useCallback)((function(e){B(!1),_(0),k(e)}),[]),pe=Object(a.useCallback)((function(){_(0)}),[]),me=Object(a.useCallback)((function(e){ze=e,E(!1),ze.brightness(G())}),[]);Object(a.useEffect)((function(){z()>A()&&S(A()),A()>0&&(ve(),B(!1))}),[A()]),Object(a.useEffect)((function(){ie&&se()}),[$,h(),L(),H()]),Object(g.a)((function(){0!==A()&&(0===z()?se():S((function(e){return e-1})))}),1e3);var ye=j?null:l.a.createElement(o.a,{title:re("keyviz.settings.disabled_result.title"),subTitle:re("keyviz.settings.disabled_result.sub_title"),extra:l.a.createElement(s.a,{type:"primary",onClick:ae},re("keyviz.settings.open_setting"))}),ge=ie?n&&l.a.createElement(Z,{data:n.heatmapData,dataTag:n.metricType,onBrush:he,onChartInit:me,onZoom:pe}):ye;return l.a.createElement("div",{className:"PD-KeyVis"},l.a.createElement(Te,{enabled:ie,dateRange:L(),metricType:H(),brightLevel:G(),onToggleBrush:fe,onResetZoom:ve,isLoading:j,autoRefreshSeconds:A(),remainingRefreshSeconds:z(),isOnBrush:D(),onChangeBrightLevel:ue,onChangeMetric:q,onChangeDateRange:de,onChangeAutoRefresh:_,onRefresh:se,onShowSettings:ae}),ge,l.a.createElement(i.a,{title:re("keyviz.settings.title"),width:300,closable:!0,visible:ne,onClose:le,destroyOnClose:!0},l.a.createElement(ce,{onClose:le,onConfigUpdated:oe})))};t.default=function(){return l.a.createElement(r.w,null,l.a.createElement(De,null))}}}]);
//# sourceMappingURL=app_keyviz.de5bad26.chunk.js.map